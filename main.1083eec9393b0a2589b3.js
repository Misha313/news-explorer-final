!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.api=t,this.header=n,this.headerBtn=this.header.querySelector(".button"),this.savedLink=this.header.querySelector(".header-nav__link-saved"),this.btn=this.header.querySelector(".button")}var t,n,o;return t=e,(n=[{key:"_render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;e?(this.btn.textContent=t,this.savedLink.style.display="flex"):(this.savedLink.style.display="none",this.headerBtn.textContent=t)}},{key:"logoutInSave",value:function(){this.headerBtn.addEventListener("click",(function(){localStorage.removeItem("token"),window.location.reload(),console.log(localStorage.getItem("token"))}))}},{key:"redirect",value:function(){localStorage.getItem("token")||(document.location.href="./index.html")}},{key:"checkLogin",value:function(){var e=this;this.api.getUserData().then((function(t){e._render(1,t.name)})).catch((function(t){return e._render(0,"Авторизоваться"),console.log(t)}))}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mainApi=t,this.keyWord=n,this.cardId=""}var t,n,o;return t=e,(n=[{key:"create",value:function(e,t,n,r,o,i,s){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"undefind",c='\n    <div class="news-card">\n    <div class="id" style="display: none;"></div>\n    <img alt="background" src="" class="news-card__image">\n    <div class="news-card__save-icon"></div>\n    <div class="news-card__delete-icon news-card__save-icon"style="display: none;"></div>\n    <div class="news-card__keyword" style="display: none;"></div>\n    <div class="news-card__content" >\n      <div class="news-card__data">2 августа, 2019</div>\n      <h2 class="news-card__title">Национальное достояние – парки</h2>\n      <p class="news-card__text">В 2016 году Америка отмечала важный юбилей: сто лет назад здесь начала\n        складываться система национальных парков – охраняемых территорий, где и сегодня каждый может приобщиться к\n        природе.</p>\n      <a class="news-card__source" href="https://lenta.ru/" target="_blank">Лента.ру</a>\n    </div>\n  </div>\n    ',l=document.createElement("div");l.insertAdjacentHTML("afterbegin",c);var u=l.firstElementChild;return u.querySelector(".news-card__image").setAttribute("src",i),u.querySelector(".news-card__data").textContent=e.substr(0,10),u.querySelector(".news-card__title").textContent=t,u.querySelector(".news-card__text").textContent=n,u.querySelector(".news-card__source").textContent=r,u.querySelector(".news-card__source").setAttribute("href",o),u.querySelector(".news-card__keyword").textContent=s,u.querySelector(".id").textContent=a,this.keyWord=s,this.card=u,this.card.addEventListener("click",this.goToNews),this.renderIcon(),this.card}},{key:"renderIcon",value:function(){var e=this;if(localStorage.getItem("token"))this.card.querySelector(".news-card__save-icon").style.background="url(./images/saveHover.svg)",this.card.querySelector(".news-card__save-icon").addEventListener("click",(function(t){return e.saveAndDeleteCard.bind(e)(t)}));else{var t=this.card.querySelector(".news-card__save-icon");t.style.background="url(./images/save.svg)",t.insertAdjacentHTML("afterend",'<div class="news-card__tooltip">Ввойдите, чтобы сохраниять статьи</div>'),t.addEventListener("mouseover",(function(t){return e.mouseoverHandlerNotLogin.bind(e)(t)})),t.addEventListener("mouseout",(function(t){return e.mouseoutHandlerNotLogin.bind(e)(t)}))}}},{key:"saveAndDeleteCard",value:function(e){var t=this,n=e.target.closest(".news-card"),r=n.querySelector(".news-card__save-icon"),o=n.querySelector(".news-card__image").getAttribute("src"),i=n.querySelector(".news-card__data").textContent,s=n.querySelector(".news-card__title").textContent,a=n.querySelector(".news-card__text").textContent,c=n.querySelector(".news-card__source").textContent,l=n.querySelector(".news-card__source").getAttribute("href"),u=n.querySelector(".news-card__keyword").textContent;e.target.closest(".news-card").classList.contains("saved")?this.mainApi.deleteNews(this.cardId).then((function(e){r.style.background='url("./images/saveHover.svg")',n.classList.remove("saved")})).catch((function(e){console.log(e)})):this.mainApi.saveNews(u,s,a,i,c,l,o).then((function(e){t.cardId=e._id,r.style.background="url(./images/saveActive.svg)",n.classList.add("saved")})).catch((function(e){console.log(e)}))}},{key:"goToNews",value:function(e){if(!e.target.classList.contains("news-card__save-icon")){var t=e.target.closest(".news-card").querySelector(".news-card__source").getAttribute("href");document.location.href=t}}},{key:"mouseoverHandlerNotLogin",value:function(e){e.target.closest(".news-card").querySelector(".news-card__tooltip").style.display="flex"}},{key:"mouseoutHandlerNotLogin",value:function(e){e.target.closest(".news-card").querySelector(".news-card__tooltip").style.display="none"}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.baseUrl=t.baseUrl,this.headers=t.headers}var t,n,o;return t=e,(n=[{key:"signin",value:function(e,t){return fetch("".concat(this.baseUrl,"/signin"),{method:"POST",headers:this.headers,body:JSON.stringify({password:e,email:t})}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}},{key:"signup",value:function(e,t,n){return fetch("".concat(this.baseUrl,"/signup"),{method:"POST",headers:this.headers,body:JSON.stringify({email:e,password:t,name:n})}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}},{key:"getUserData",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{method:"GET",headers:{authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}},{key:"getNews",value:function(){return fetch("".concat(this.baseUrl,"/articles/"),{method:"GET",headers:{authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}},{key:"saveNews",value:function(e,t,n,r,o,i,s){return fetch("".concat(this.baseUrl,"/articles"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({keyword:e,title:t,text:n,date:r,source:o,link:i,image:s})}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}},{key:"deleteNews",value:function(e){return fetch("".concat(this.baseUrl,"/articles/").concat(e),{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json",authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}}])&&r(t.prototype,n),o&&r(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={baseUrl:"https://www.api.news-aggreg.tk",headers:{Accept:"application/json","Content-Type":"application/json"}}},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);n(4);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n,r,o,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=t,this._popupSuccess=i,this._popupReg=r,this._buttonHeader=n,this._closePopups=o,this._inputs=this._popup.querySelectorAll(".popup__input"),this._open=this._open.bind(this),this._openReg=this._openReg.bind(this),this._close=this._close.bind(this),this.classHeader=s}var t,n,o;return t=e,(n=[{key:"_open",value:function(e){"Авторизоваться"===e.target.textContent?(this._popupReg.style.display="none",this._popup.style.display="flex"):(localStorage.removeItem("token"),this.classHeader.checkLogin(),window.location.reload())}},{key:"_openReg",value:function(e){this._popup.style.display="none",this._popupReg.style.display="flex",this._close()}},{key:"_close",value:function(e){e.target.closest(".popup").style.display="none",this._clearContent()}},{key:"_setHandlers",value:function(){var e=this;this._buttonHeader.addEventListener("click",this._open),this._closePopups.forEach((function(t){t.addEventListener("click",e._close)})),this._popup.querySelector(".popup__close").addEventListener("click",(function(t){return e._close})),this._popup.querySelector(".popup__footer-link").addEventListener("click",this._openReg),this._popupReg.querySelector(".popup__footer-link").addEventListener("click",this._open),this._popupSuccess.querySelector(".popup__footer-link").addEventListener("click",this._closeSuccess.bind(this))}},{key:"_closeSuccess",value:function(e){e.target.closest(".popup").style.display="none",console.log(this._popup),this._popup.style.display="flex"}},{key:"_clearContent",value:function(){console.log(this._inputs),this._inputs.forEach((function(e){e.value=""}))}}])&&r(t.prototype,n),o&&r(t,o),e}(),i=n(0);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=t,this.classHeader=o,this.popupSuccess=r,this.loginInPopupSuccess=this.popupSuccess.querySelector(".popup-success__footer-link"),this._popupError=t.querySelector(".popup__error"),this._loginError=this._form.querySelector(".popup__user-error"),this.api=n,this.passwordField=this._form.password,this.emailField=this._form.email,this.nameField=this._form.userName}var t,n,r;return t=e,(n=[{key:"setEventListeners",value:function(){var e=this;this._form.addEventListener("input",this.handleSendToValidate.bind(this)),this._form.addEventListener("submit",(function(t){return e.handlerFormSubmit.bind(e)(t)}))}},{key:"handlerFormSubmit",value:function(e){e.preventDefault(),"registration"===this._form.name&&this._registration(),"login"===this._form.name&&this._signin()}},{key:"_signin",value:function(){var e=this;this.api.signin(this.passwordField.value,this.emailField.value).then((function(t){t&&(localStorage.setItem("token",t.token),e._form.closest(".popup").style.display="none",e.classHeader.checkLogin())})).catch((function(t){console.log(t),e._loginError.textContent="Неправильные имя или пароль"}))}},{key:"_registration",value:function(){var e=this;console.log("email:".concat(this.emailField.value,",password:").concat(this.passwordField.value,",name:").concat(this.nameField.value)),this.api.signup(this.emailField.value,this.passwordField.value,this.nameField.value).then((function(t){e._form.closest(".popup").style.display="none",e.popupSuccess.style.display="flex"}))}},{key:"checkInputValidity",value:function(e){var t=event.target.closest(".popup__input-wrapper").querySelector(".popup__error");return event.target.validity.valid?(t.textContent="",!0):event.target.validity.patternMismatch?(t.textContent="Неправильный формат email",!1):event.target.classList.contains("popup__input-name")?(t.textContent="Имя должно быть от 2 до 30 символов",!1):event.target.validity.tooShort||event.target.validity.tooLong?(t.textContent="Пароль должен быть минимум 8 символов в длинну",!1):void 0}},{key:"setSubmitButtonForm",value:function(e,t){e.disabled=!t.checkValidity()}},{key:"handleSendToValidate",value:function(){var e=this._form.querySelector(".button");this.checkInputValidity(event.target),this.setSubmitButtonForm(e,this._form)}}])&&s(t.prototype,n),r&&s(t,r),e}(),c=n(1);function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.newsApi=t,this.resultBlock=n,this.resultContainer=this.resultBlock.querySelector(".result__container"),this.createCard=r,this.searchForm=document.querySelector(".search"),this.searchBtn=this.searchForm.querySelector(".search__btn"),this.searchField=this.searchForm.querySelector(".search__field"),this.preloader=document.querySelector(".preloader"),this.searchNotResult=document.querySelector(".search-not-result"),this.articlesCurrent=void 0,this.showMoreBtn=o,this.keyWord=this.searchField.value}var t,n,r;return t=e,(n=[{key:"setEventListener",value:function(){var e=this;this.searchBtn.addEventListener("click",(function(t){return e.handlerSubmitSearch.bind(e)(t)})),this.showMoreBtn.addEventListener("click",this.addCards.bind(this))}},{key:"handlerSubmitSearch",value:function(e){this.validateSearch(),e.preventDefault()}},{key:"validateSearch",value:function(){this.searchField.checkValidity()?this.searchNews(this.searchField.value):this.searchField.placeholder="Нужно ввести ключевое слово"}},{key:"addCards",value:function(){if(this.resultContainer.textContent="",this.articlesCurrent.length>=3){for(var e=0;e<3;e++)this.resultContainer.appendChild(this.createCard.create(this.articlesCurrent[e].publishedAt,this.articlesCurrent[e].title,this.articlesCurrent[e].description,this.articlesCurrent[e].source.name,this.articlesCurrent[e].url,this.articlesCurrent[e].urlToImage,this.keyWord));this.articlesCurrent=this.articlesCurrent.slice(3)}else{this.showMoreBtn.style.display="none";for(var t=0;t<this.articlesCurrent.length;t++)console.log("for"),this.resultContainer.appendChild(this.createCard.create(this.articlesCurrent[t].publishedAt,this.articlesCurrent[t].title,this.articlesCurrent[t].description,this.articlesCurrent[t].source.name,this.articlesCurrent[t].url,this.articlesCurrent[t].urlToImage)),this.articlesCurrent=this.articlesCurrent.slice(1)}}},{key:"searchNews",value:function(e){var t=this;this.preloader.style.display="flex",this.keyWord=e,this.newsApi.getNews(e).then((function(e){t.preloader.style.display="none",0===e.articles.length?(t.searchNotResult.style.display="flex",t.resultBlock.style.display="none"):(t.resultBlock.style.display="flex",t.articlesCurrent=e.articles,t.addCards())})).catch((function(e){t.searchNotResult.style.display="flex",document.querySelector(".search-not-result__title").textContent="Какая-то проблема",document.querySelector(".search-not-result__text").textContent="Повторите попытку или попробуйте позже",console.log(e)}))}}])&&l(t.prototype,n),r&&l(t,r),e}(),d=n(2);function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t.baseUrl,this.apiKey=t.apiKey}var t,n,r;return t=e,(n=[{key:"getNews",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return fetch("".concat(this.baseUrl,"q=").concat(e,"&pageSize=").concat(t,"&apiKey=").concat(this.apiKey)).then((function(e){return e.ok?e.json():Promise.reject(e)}))}}])&&h(t.prototype,n),r&&h(t,r),e}(),f=n(3),y={baseUrl:"https://newsapi.org/v2/everything?",apiKey:"a62507c35dbc4506b75ac81de50b8d04"};!function(){var e=document.querySelector(".header"),t=document.querySelector(".popup-login"),n=document.querySelector(".popup-registr"),r=document.querySelector(".popup-success"),s=document.querySelectorAll(".popup__close"),l=document.querySelector(".button-header"),h=document.querySelector(".popup__form-login"),v=document.querySelector(".popup__form-reg"),_=document.querySelector(".result"),g=document.querySelector(".result__show-more-btn"),m=new p(y),b=new d.a(f.a),k=new c.a(b);new u(m,_,k,g).setEventListener();var w=new i.a(b,e);w.checkLogin(),new a(h,b,r,w).setEventListeners(),new a(v,b,r,w).setEventListeners(),new o(t,l,n,s,r,w)._setHandlers()}()}]);